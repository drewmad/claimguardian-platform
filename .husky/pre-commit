
# Pre-commit hook with progressive checks
echo "ðŸš€ Running pre-commit checks..."

# 1. Ensure lockfile is in sync
echo "ðŸ”’ Checking lockfile..."
if [ -f "scripts/sync-lockfile.js" ]; then
  node scripts/sync-lockfile.js --fix --stage || true
fi

# 2. Run dependency check
echo "ðŸ“¦ Validating dependencies..."
pnpm deps:check || {
  echo "âŒ Dependency check failed. Your pnpm-lock.yaml is out of sync."
  echo "   Please run 'pnpm install' and then commit your changes."
  exit 1
}

# 3. Auto-fix lint issues (but don't block on failures)
echo "ðŸ”§ Auto-fixing code style..."
if [ -f "scripts/auto-fix-lint.js" ]; then
  node scripts/auto-fix-lint.js || true
fi

# 4. Run type check (warn but don't block for now)
echo "ðŸ” Type checking..."
pnpm type-check || {
  echo "âš ï¸  Type errors found. These should be fixed soon."
  echo "   Continuing with commit..."
}

# 5. Database checks if Supabase is running
if command -v supabase >/dev/null 2>&1 && supabase status 2>/dev/null | grep -q "API URL"; then
  echo "ðŸ—„ï¸  Checking database..."
  cd apps/web 2>/dev/null && pnpm db:lint 2>/dev/null || true
  cd - >/dev/null 2>&1
fi

echo "âœ… Pre-commit checks complete!"
echo ""
echo "ðŸ’¡ Note: Some lint warnings may remain. Fix them in future commits."